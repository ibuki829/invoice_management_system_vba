# invoice_management_system_vba
概要
本システムは、中小規模事業者向けの納品書・請求書発行アプリケーションである。 Microsoft Accessを使用し、入力効率化（オートコンプリート）と堅牢なデータ保持（非正規化フィールドの活用）を特徴とする。

1. データベース構造 (ER図・スキーマ)
T_売上 (ヘッダーテーブル)
売上伝票の基本情報を管理する。

売上ID (PK/AutoNumber): システム内部ID。

顧客ID (FK): T_顧客マスタ への参照。

売上日付: 伝票日付。

納品先名 (Text): 【履歴保持用】 マスタ参照時の名称をテキストとして保存。

郵便番号, 住所1, 住所2, 電話番号: 【履歴保持用】 納品時点の情報を保存。

備考: 自由記述欄。

T_売上明細 (明細テーブル)
伝票の商品行を管理する。

売上明細ID (PK/AutoNumber): 行ID。

売上ID (FK): T_売上 とのリレーション用。

商品ID (FK): T_商品マスタ への参照。

商品名_保存用 (Text): 【履歴保持用】 マスタ変更の影響を受けないよう名称を保存。

数量 (Number): 取引数量。

単価_保存用 (Currency): 【履歴保持用】 その時点の単価を保存。

マスタテーブル
T_顧客マスタ: 顧客ID, 顧客名, 住所情報などを管理。

T_商品マスタ: 商品ID, 商品名, 標準単価を管理。

2. インターフェース実装ロジック
入力フォーム (F_売上入力)
オートコンプリート:

顧客検索用コンボボックスは SELECT 顧客名, 顧客ID FROM T_顧客マスタ ORDER BY 顧客名 をソースとし、入力時の検索性を向上させている。

ColumnWidths プロパティにより、ID列を隠しつつ名称で検索可能に設定。

同期処理:

コンボボックスの AfterUpdate イベントにて Requery を発行し、即座に関連フィールド（住所やID）を画面に反映させるロジックを実装。

印刷機能 (R_納品書, R_請求書)
用紙サイズ: B5 (JIS) 縦。

出力方式: 「個別レポート連続出力方式」 を採用。

当初は2面付け（1枚に納品書・請求書を配置）を検討したが、Accessのレポートエンジンの仕様上、明細行数の増減による改ページ判定が不安定になるため廃止。

「納品書」と「請求書」を独立したレポートファイルとして作成し、マクロにより連続でプレビュー/印刷する仕様とした。

フィルタリング:

印刷ボタン押下時に DoCmd.OpenReport の WhereCondition 引数を使用し、[売上ID]=[Forms]![F_売上入力]![売上ID] を渡すことで、カレントレコードのみを出力する。

3. 今後の拡張性・保守について
消費税対応:

現在は単純な合計計算のみ実装。将来的にインボイス制度対応（税率ごとの集計）が必要な場合は、クエリレベルでの計算式追加が必要。

レポートの修正:

レイアウト修正時は、R_納品書 および R_請求書 を個別にデザインビューで編集すること。

ページ設定の「余白」および「詳細セクションの高さ」は、B5用紙の印刷可能領域ギリギリに設定されているため、変更時は改ページズレに注意すること。
